/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/core/mvc/XMLView","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/json/JSONModel"],function(q,C,X,F,c,J){"use strict";var s='		.blanket-source {			overflow-x: scroll;			background-color: #FFFFFF;			border: 1px solid #CBCBCB;			color: #363636;			margin: 25px 20px;			width: 80%;		}		.blanket-source div {			white-space: pre;			tab-size: 4;			font-family: monospace;		}		.blanket-source > div > span:first-child {			background-color: #EAEAEA;			color: #949494;			display: inline-block;			padding: 0 10px;			text-align: center;			width: 30px;		}		.blanket-source .hits {			background-color: #EAEAEA;			color: green;			display: inline-block;			padding: 0 10px;			text-align: right;			width: 30px;		}		.blanket-source span.highlight {			color: black;			background-color: yellow		}		.blanket-source .hit {			background-color: lightgreen		}		.blanket-source .miss {			background-color: #e6c3c7		}		.blanket-source .skipped {			font-style: italic		}		.blanket-source .miss span.highlight {			background-color: #e6c3c7		}	';C.extend("sap.ui.test.BlanketReporterUI",{filterThreshold:function(b){var B,o=null,t=this.byId("Files"),T=this.getView().getModel().getProperty("/threshold");if(b){o=new F({filters:[new F("lines/coverage","LT",T),new F("branches/coverage","LT",T)],and:false});}B=t.getBinding("rows");B.filter(o,c.Application);},onBeforeRendering:function(){this.filterThreshold(this.getView().getModel().getProperty("/filterThreshold"));},onFilterThreshold:function(E){this.filterThreshold(E.getParameter("selected"));},onRowSelection:function(){var o,a,H=this.byId("blanket-source"),L,m=this.getView().getModel(),S,t=this.byId("Files"),i=t.getSelectedIndex()-t.getFirstVisibleRow();if(i>=0){o=t.getRows()[i].getBindingContext();a=o.getObject("name");L=m.getProperty("/linesOfContext");S=m.getObject("/coverageData").files[a];H.setContent('<div class="blanket-source">'+e(S,L,m.getProperty("/showHits"))+"</div>");H.setVisible(true);}else{H.setContent("<div/>");}}});function d(S,H,L,m,n){var o=0,r=-Infinity,P=L.reduce(y,[]).sort(u),t=0;function u(a,b){return a.line-b.line||a.column-b.column;}function v(){var a="";if(t>0){a="<div class='ellipsis'><span>...</span>";if(n){a+="<span class='hits'>&nbsp;</span>";}a+="<span class='skipped'>"+t+" lines skipped</span></div>";t=0;}return a;}function w(i,a){a=q.sap.encodeHTML(a);if(a&&o){r=i;a="<span class='highlight'>"+a+"</span>";}return a;}function x(i,a){var b=0,R="";while(P.length&&i===P[0].line){R+=w(i,a.slice(b,P[0].column));b=P[0].column;o+=P.shift().delta;}R+=w(i,a.slice(b));return R;}function y(P,a){a.start.delta=+1;P.push(a.start);a.end.delta=-1;P.push(a.end);return P;}if(m===undefined){m=Infinity;}return S.reduce(function(a,b,z){var N=P.length&&P[0].line||Infinity,A=n?H.findIndex(function(D,i){return D!==undefined&&i>=z;}):H.indexOf(0,z);function B(){a+="<div";if(H[z]===0){a+=" class='miss'";r=z;}else if(n&&H[z]>0){a+=" class='hit'";}a+="><span>"+z+"</span>";if(n){a+="<span class='hits'>"+(H[z]>=0?H[z]+"x":"&nbsp;")+"</span>";}a+=x(z,b)+"</div>";}if(A>=0&&A<N){N=A;}z+=1;if(z>=N-m||z<=r+m||N-r===2*(m+1)){a+=v();B();}else{t+=1;}return a;},"")+v();}function g(E,a,D){var v=parseInt(E.getAttribute(a),10);return v>0?v:D;}function e(S,L,b){var a=S.branchTracking?S.branchTracking.reduce(i,[]):[];function i(a,r){if(!r.falsy){a.push(r.alternate);}if(!r.truthy){a.push(r.consequent);}return a;}return d(S.source,S,a,b?Infinity:L,b);}function p(m,t){return t?(t-m)/t*100:100;}function f(S){S.lines.coverage=p(S.lines.missed,S.lines.total);S.branches.coverage=p(S.branches.missed,S.branches.total);}function h(o,L,t,T){var a={files:[],lines:{total:0,missed:0,coverage:100},branches:{total:0,missed:0,coverage:100},coverageData:o,filterThreshold:!!t,branchTracking:false,showHits:false};function b(m){var n=o.files[m],r={name:m,lines:{total:0,missed:0,coverage:100},branches:{total:0,missed:0,coverage:100}},i;for(i=0;i<n.length;i++){if(n[i]!==undefined){r.lines.total++;if(n[i]===0){r.lines.missed++;}}}if(n.branchTracking){a.branchTracking=true;r.branches.total=n.branchTracking.length;for(i=0;i<n.branchTracking.length;i++){if(!n.branchTracking[i].falsy||!n.branchTracking[i].truthy){r.branches.missed++;}}}f(r);a.files.push(r);a.lines.total+=r.lines.total;a.lines.missed+=r.lines.missed;a.branches.total+=r.branches.total;a.branches.missed+=r.branches.missed;}if(T){T.filter(function(i){return i in o.files;}).forEach(b);a.filterThreshold=false;}else{Object.keys(o.files).sort().forEach(b);}a.linesOfContext=L;a.threshold=t;a.visible=Math.min(Math.max(a.files.length,3),10);f(a);return new J(a);}function j(m){return sap.ui.xmlview({viewName:"sap.ui.test.BlanketReporterUI",models:m});}function k(v){var D=document.createElement("div"),S=document.createElement("style");D.setAttribute("id","blanket-view");D.setAttribute("class","sapUiBody");document.body.appendChild(D);v.placeAt(D);S.innerHTML=s;document.head.appendChild(S);}function l(m){return q.sap.getResourceName(m);}return function(S,G,o){var L,t,T;if(!document.getElementById("blanket-view")){L=g(S,"data-lines-of-context",3);T=Math.min(g(S,"data-threshold",0),100);t=G();k(j(h(o,L,T,t&&t.map(l))));}};},false);
