/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/base/ManagedObject','sap/ui/base/EventProvider','jquery.sap.script'],function(q,B,M,E){"use strict";var a=B.extend("sap.ui.base.ManagedObjectObserver",{constructor:function(C){if(!C&&typeof C!=="function"){throw new Error("Missing callback function in ManagedObjectObserver constructor");}this._fnCallback=C;}});a.prototype.observe=function(o,C){if(!(o instanceof M)){if(o==null){return;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but observe was called for "+o);}m(o,C);c(o,this,C);};a.prototype.unobserve=function(o,C){if(!(o instanceof M)){if(o==null){return;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but unobserve was called for "+o);}if(C){m(o,C);}r(o,this,C);};a.prototype.isObserved=function(o,C){if(!(o instanceof M)){if(o==null){return false;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but isObserved was called for "+o);}return d(o,this,C);};a.prototype.disconnect=function(){e(this);};a.prototype.getConfiguration=function(o){return g(o,this);};var O={},t=Object.create(null);O.propertyChange=function(o,n,v,N){h("properties",o,n,function(){return{type:"property",old:v,current:N};});};O.aggregationChange=function(o,n,s,v){h("aggregations",o,n,function(){return{type:"aggregation",mutation:s,children:Array.isArray(v)?v:null,child:!Array.isArray(v)?v:null};});};O.associationChange=function(o,n,s,i){h("associations",o,n,function(){return{type:"association",mutation:s,ids:i};});};O.eventChange=function(o,n,s,L,F,D){h("events",o,n,function(){return{type:"event",mutation:s,listener:L,func:F,data:D};});};O.bindingChange=function(o,n,s,i,p){h("bindings",o,n,function(){return{type:"binding",mutation:s,bindingInfo:i,memberType:p};});};O.objectDestroyed=function(o){h("destroy",o,null,function(){return{type:"destroy"};});var i=o.getId();if(t[i]){o.detachEvent("EventHandlerChange",H);delete t[i];}delete o._observer;};function h(T,o,n,C){var I=o.getId(),p=t[I];if(p){var s;for(var i=0;i<p.listeners.length;i++){if(b(p.configurations[i],T,n)){if(!s){s=C();s.name=n;s.object=o;}var L=p.listeners[i];L._fnCallback(s);}}}}function b(C,T,n){if(C==null||!T){return false;}if(T!="destroy"&&!n){return false;}return C[T]===true||(Array.isArray(C[T])&&C[T].indexOf(n)>-1);}function c(T,L,C){u(T,L,C,false);}function g(T,L){var i=T.getId();var o=t[i];if(o&&o.listeners){var I=o.listeners.indexOf(L);if(I>=0){var C=q.extend(true,{},o.configurations[I]);return C;}}return null;}function r(T,L,C){C=C||g(T,L);u(T,L,C,true);}function d(T,L,C){var i=T.getId(),o=t[i];C=C||g(T,L);if(!o){return false;}var I=o.listeners.indexOf(L);if(I===-1){return false;}else{return k(o.configurations[I].properties,C.properties)&&k(o.configurations[I].aggregations,C.aggregations)&&k(o.configurations[I].associations,C.associations)&&k(o.configurations[I].bindings,C.bindings)&&k(o.configurations[I].events,C.events)&&l(o.configurations[I].destroy,C.destroy);}}function e(L){for(var n in t){var T=t[n];for(var i=0;i<T.listeners.length;i++){if(T.listeners[i]===L){T.listeners.splice(i,1);T.configurations.splice(i,1);}}if(T.listeners&&T.listeners.length===0){delete t[n];T.object._observer=undefined;}}}function u(T,L,C,R){var i=T.getId(),o=t[i],n,I;if(R){if(!o){return;}I=o.listeners.indexOf(L);if(I>=0){n=o.configurations[I];}}else{if(!o){o=t[i]={listeners:[],configurations:[],object:T};}I=o.listeners.indexOf(L);if(I===-1){o.listeners.push(L);o.configurations.push(C);}else{n=o.configurations[I];}}if(n){n.properties=n.properties||[];j(n.properties,C.properties,R);n.aggregations=n.aggregations||[];j(n.aggregations,C.aggregations,R);n.associations=n.associations||[];j(n.associations,C.associations,R);n.bindings=n.bindings||[];j(n.bindings,C.bindings,R);n.events=n.events||[];j(n.events,C.events,R);if(C.destroy!=null){if(R){delete n.destroy;}else{n.destroy=C.destroy;}}}var p=f(T,"events");if(T._observer&&R){if(!p&&E.hasListener(T,"EventHandlerChange",H)){T.detachEvent("EventHandlerChange",H);}if(!p&&!f(T,"properties")&&!f(T,"aggregations")&&!f(T,"associations")&&!f(T,"destroy")&&!f(T,"bindings")){delete T._observer;delete t[i];}}else if(!T._observer&&!R){if(p&&!E.hasListener(T,"EventHandlerChange",H)){T.attachEvent("EventHandlerChange",H);}T._observer=O;}}function f(T,s){var i=T.getId(),o=t[i];if(o){var C=o.configurations.filter(function(n){return n.hasOwnProperty(s)&&n[s]&&(n[s]===true||n[s].length>0);});return C.length>0;}return false;}function H(o){var T=o.getSource(),s=o.mParameters.EventId;if(T.getMetadata().hasEvent(s)){if(o.mParameters.type==="listenerAttached"){O.eventChange(T,s,"insert",o.mParameters.listener,o.mParameters.func,o.mParameters.data);}else if(o.mParameters.type==="listenerDetached"){O.eventChange(T,s,"remove",o.mParameters.listener,o.mParameters.func,o.mParameters.data);}}}function j(o,A,R){if(!A){return;}for(var i=0;i<A.length;i++){var I=o.indexOf(A[i]);if(I>-1&&R){o.splice(I,1);}else if(I===-1&&!R){o.push(A[i]);}}}function k(F,s){if(!Array.isArray(s)||s.length==0){return true;}if(!Array.isArray(F)||F.length==0){return false;}var U=q.sap.unique(F.concat(s));return F.length===U.length;}function l(o,C){if(C==null){return true;}return o===C;}function m(o,C){var i=o.getMetadata(),p=Object.keys(i.getAllProperties()),A=Object.keys(i.getAllAggregations()),n=Object.keys(i.getAllAssociations()),s=q.sap.unique(p.concat(A)),v=Object.keys(i.getAllEvents());C.properties=C.properties===true?p:C.properties;C.aggregations=C.aggregations===true?A:C.aggregations;C.associations=C.associations===true?n:C.associations;C.bindings=C.bindings===true?s:C.bindings;C.events=C.events===true?v:C.events;C.destroy=(C.destroy==null)?false:C.destroy;}return a;});
