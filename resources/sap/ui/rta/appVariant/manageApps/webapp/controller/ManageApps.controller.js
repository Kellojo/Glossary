/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/rta/appVariant/manageApps/webapp/model/models","sap/ui/rta/appVariant/Utils","sap/m/MessageBox","sap/ui/rta/Utils","sap/ui/rta/appVariant/Feature","sap/ui/rta/RuntimeAuthoring","sap/ui/core/BusyIndicator","sap/ui/rta/appVariant/AppVariantUtils"],function(q,C,M,A,a,R,b,c,B,d){"use strict";var _,e,m,i;return C.extend("sap.ui.rta.appVariant.manageApps.webapp.controller.ManageApps",{onInit:function(){_=this.getOwnerComponent().getIdRunningApp();e=this.getOwnerComponent().getIsOverviewForKeyUser();m=q.sap.getModulePath("sap.ui.rta.appVariant.manageApps.webapp");i=q.sap.resources({url:m+"/i18n/i18n.properties"});B.show();return A.getAppVariantOverview(_,e).then(function(f){B.hide();if(f.length){return this._arrangeOverviewDataAndBindToModel(f).then(function(f){return this._highlightNewCreatedAppVariant(f);}.bind(this));}else{d.publishEventBus();return this._showMessageWhenNoAppVariantsExist();}}.bind(this))["catch"](function(E){d.publishEventBus();var o=d.buildErrorInfo("MSG_MANAGE_APPS_FAILED",E);o.overviewDialog=true;B.hide();return d.showRelevantDialog(o,false);});},_showMessageWhenNoAppVariantsExist:function(){var s=i.getText("MSG_APP_VARIANT_OVERVIEW_SAP_DEVELOPER");var t=i.getText("TITLE_APP_VARIANT_OVERVIEW_SAP_DEVELOPER");return new Promise(function(r){a.show(s,{icon:a.Icon.INFORMATION,title:t,onClose:r,styleClass:R.getRtaStyleClassName()});});},_highlightNewCreatedAppVariant:function(f){var t=this.byId("Table1");f.forEach(function(o,g){if(o.currentStatus){if(t.getItems().length>=g){t.getItems()[g].focus();}}});return Promise.resolve();},_arrangeOverviewDataAndBindToModel:function(f){var g=f.filter(function(l){return l.appId===_;});var o=g[0];if(o){o.currentStatus=i.getText("MAA_CURRENTLY_ADAPTING");}f=f.filter(function(l){return l.appId!==_;});f.unshift(o);var r=f.filter(function(l){return l.isOriginal;});var h=r[0];f=f.filter(function(l){return!l.isOriginal;});f.unshift(h);var j={appVariants:f};var k=M.createModel(j);this.getView().setModel(k);return Promise.resolve(f);},formatRowHighlight:function(v){if(v===i.getText("MAA_CURRENTLY_ADAPTING")){return"Success";}else if(v===i.getText("MAA_NEW_APP_VARIANT")){return"Information";}return"None";},getModelProperty:function(s,f){return this.getView().getModel().getProperty(s,f);},handleUiAdaptation:function(E){var n=sap.ushell.Container.getService("CrossApplicationNavigation");var s=this.getModelProperty("semanticObject",E.getSource().getBindingContext());var f=this.getModelProperty("action",E.getSource().getBindingContext());var p=this.getModelProperty("params",E.getSource().getBindingContext());var N;if(s&&f&&p){N={target:{semanticObject:s,action:f},params:p};c.enableRestart("CUSTOMER");n.toExternal(N);d.publishEventBus();return true;}else{return false;}},saveAsAppVariant:function(E){d.publishEventBus();var D=this.getModelProperty("descriptorUrl",E.getSource().getBindingContext());B.show();return A.getDescriptor(D).then(function(o){B.hide();return b.onSaveAsFromOverviewDialog(o,false);});},copyId:function(E){var s=this.getModelProperty("appId",E.getSource().getBindingContext());d.copyId(s);}});});
