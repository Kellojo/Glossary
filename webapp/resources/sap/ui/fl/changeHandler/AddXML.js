/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/fl/changeHandler/Base","sap/ui/fl/Utils"],function(q,B,U){"use strict";var A={};var d=function(c){c.forEach(function(C){if(C.destroy){C.destroy();}});};A.applyChange=function(c,C,p){var m=p.modifier;var o=c.getDefinition();var a=o.content.targetAggregation;if(!o.content.fragment){throw new Error("The content of the fragment is not set. This should happen in the backend");}var f=U.asciiToString(o.content.fragment);var i=o.content.index;var v=p.view;var V=U.getViewForControl(C);var b=V&&V.getController();var n;try{n=m.instantiateFragment(f,c.getId(),V,b);}catch(e){throw new Error("The following XML Fragment could not be instantiated: "+f);}var g=m.findAggregation(C,a);if(!g){d(n);throw new Error("The given Aggregation is not available in the given control: "+m.getId(C));}n.forEach(function(N,I){if(!m.validateType(N,g,C,f,I)){d(n);throw new Error("The content of the xml fragment does not match the type of the targetAggregation: "+g.type);}});n.forEach(function(N,I){m.insertAggregation(C,a,N,i+I,v);});c.setRevertData(n.map(function(h){return m.getId(h);}));return true;};A.revertChange=function(c,C,p){var m=p.modifier;var o=c.getDefinition();var a=o.content.targetAggregation;var v=p.view;var b=p.appComponent;var r=c.getRevertData()||[];var e=r.map(function(i){return m.bySelector(i,b,v);});e.forEach(function(f){m.removeAggregation(C,a,f);});d(e);c.resetRevertData();return true;};A.completeChangeContent=function(c,s){var C=c.getDefinition();var _=function(a){throw new Error("Attribute missing from the change specific content'"+a+"'");};if(!C.content){C.content={};}if(s.fragmentPath){C.content.fragmentPath=s.fragmentPath;}else{_("fragmentPath");}if(s.targetAggregation){C.content.targetAggregation=s.targetAggregation;}else{_("targetAggregation");}if(s.index!==undefined){C.content.index=s.index;}else{_("index");}};return A;},true);
