/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/thirdparty/URI','sap/ui/Device','sap/ui/test/_LogCollector'],function($,U,D,_){"use strict";var f=null,F=null,o=null,a=null,b=null,r=false,u=false,A=null,c=null,O;function h(){f=F[0].contentWindow;d();e();}function d(){var i=f.onerror;f.onerror=function(E,s,L,C,t){var R=false;if(i){R=i.apply(this,arguments);}setTimeout(function(){var v=C?"\ncolumn: "+C:"";var I=t&&"\niFrame error: "+(t.stack?t.message+"\n"+t.stack:t)||"";throw new Error("Error in launched application iFrame: "+E+"\nurl: "+s+"\nline: "+L+v+I);},0);return R;};}function e(){if(u){return true;}if(f&&f.sap&&f.sap.ui&&f.sap.ui.getCore){if(!r){f.sap.ui.getCore().attachInit(g);}r=true;}return u;}function l(i){f.sap.ui.require(["sap/ui/thirdparty/sinon"],function(s){if(!s){setTimeout(function(){l(i);},50);}else{i();}});}function g(){k();if(D.browser.firefox){l(n);}else{n();}}function j(){b.sap.log.addLogListener(_.getInstance()._oListener);u=true;}function k(){b=f.jQuery;p("sap.ui.test");p("sap.ui.qunit");p("sap.ui.thirdparty");}function m(i,H,s){var t=new s(),v=new H(t),w=i.setHash,x=i.getHash,C,K=false,y=f.history.go;i.replaceHash=function(E){K=true;var G=this.getHash();C=E;t.fireEvent("hashReplaced",{sHash:E});this.changed.dispatch(E,G);};i.setHash=function(E){K=true;var R=x.call(this);C=E;t.fireEvent("hashSet",{sHash:E});w.apply(this,arguments);if(R===this.getHash()){this.changed.dispatch(R,v.aHistory[v.iHistoryPosition]);}};i.getHash=function(){if(C===undefined){return x.apply(this,arguments);}return C;};i.changed.add(function(N){if(!K){t.fireEvent("hashSet",{sHash:N});C=N;}K=false;});t.init();function z(){K=true;var N=v.aHistory[v.iHistoryPosition],E=v.getPreviousHash();C=E;i.changed.dispatch(E,N);}function B(){K=true;var N=v.aHistory[v.iHistoryPosition+1],E=v.aHistory[v.iHistoryPosition];if(N===undefined){$.sap.log.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return;}C=N;i.changed.dispatch(N,E);}f.history.back=z;f.history.forward=B;f.history.go=function(S){if(S===-1){z();return;}else if(S===1){B();return;}$.sap.log.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return y.apply(f.history,arguments);};}function n(){f.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_OpaLogger","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(i,s,t,Q,v,H,w){t.setLevel(O);o=new i();A=s;a=Q;m(v,H,w);c=w;j();});}function p(M){var s=$.sap.getModulePath(M);var i=new U(s).absoluteTo(document.baseURI).search("").toString();b.sap.registerModulePath(M,i);}function q(){if(!f){throw new Error("sap.ui.test.launchers.iFrameLauncher: Teardown was called before launch. No iFrame was loaded.");}f.onerror=$.noop;for(var i=0;i<F.length;i++){F[0].src="about:blank";F[0].contentWindow.document.write('');F[0].contentWindow.close();}if(typeof CollectGarbage=="function"){CollectGarbage();}F.remove();b=null;o=null;a=null;f=null;u=false;r=false;A=null;c=null;}return{launch:function(i){if(f){throw new Error("sap.ui.test.launchers.iFrameLauncher: Launch was called twice without teardown. Only one iFrame may be loaded at a time.");}F=$("#"+i.frameId);if(!F.length){if(!i.source){$.sap.log.error("No source was given to launch the IFrame",this);}F=$('<IFrame id="'+i.frameId+'" class="opaFrame" src="'+i.source+'"></IFrame>');$("body").append(F);}if(F[0].contentDocument&&F[0].contentDocument.readyState==="complete"){h();}else{F.on("load",h);}O=i.opaLogLevel;return e();},hasLaunched:function(){e();return u;},teardown:function(){q();},getHashChanger:function(){if(!c){return null;}return c.getInstance();},getPlugin:function(){return o;},getJQuery:function(){return b;},getUtils:function(){return a;},getWindow:function(){return f;},_getAutoWaiter:function(){return A;}};},true);
