/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/dt/Util'],function(q,U){"use strict";var M={};M._getParentPropagationInfo=function(a){if(!a||!a["propagationInfos"]){return false;}return q.extend([],a["propagationInfos"]);};M._getCurrentRelevantContainerPropagation=function(e,E){var n={};if(!e.propagateRelevantContainer){return n;}else if(typeof e.propagateRelevantContainer==="function"){n.relevantContainerFunction=e.propagateRelevantContainer;n.relevantContainerElement=E;}else if(typeof e.propagateRelevantContainer==="boolean"&&e.propagateRelevantContainer){n.relevantContainerFunction=function(){return true;};n.relevantContainerElement=E;}else{var o=U.wrapError("Wrong type: it should be either a function or a boolean value and it is:"+typeof e.propagateRelevantContainer);var l='sap.ui.dt.MetadataPropagationUtil#_getCurrentRelevantContainerPropagation';o.name='Error in '+l;o.message=U.printf("{0} / {1}",l,o.message);throw o;}return n;};M._getCurrentDesigntimePropagation=function(e,E){var n={};if(!e.propagateMetadata){return n;}else if(typeof e.propagateMetadata==="function"){n.relevantContainerElement=E;n.metadataFunction=e.propagateMetadata;}else{var o=U.wrapError("Wrong type: it should be a function and it is:"+typeof e.propagateRelevantContainer);var l='sap.ui.dt.MetadataPropagationUtil#_getCurrentDesigntimePropagation';o.name='Error in '+l;o.message=U.printf("{0} / {1}",l,o.message);throw o;}return n;};M._setPropagationInfo=function(m,n,p){if(!p&&q.isEmptyObject(n)){return false;}m.propagationInfos=p?p:[];if(!q.isEmptyObject(n)){m.propagationInfos.push(n);}return m;};M.propagateMetadataToAggregationOverlay=function(o,e,p){var n,m,r,a=q.extend({},o);var P=M._getParentPropagationInfo(p);if(a&&!q.isEmptyObject(a)){r=M._getCurrentRelevantContainerPropagation(a,e);m=M._getCurrentDesigntimePropagation(a,e);}if(P||!q.isEmptyObject(r)||!q.isEmptyObject(m)){n=q.extend(r,m);return M._setPropagationInfo(a,n,P);}else{return a;}};M._getPropagation=function(p,e,c){if(!p||!p.propagationInfos){return false;}p.propagationInfos.some(function(P){return c(P);});};M.getRelevantContainerForPropagation=function(p,e){var P=false;M._getPropagation(p,e,function(o){if(o.relevantContainerFunction&&o.relevantContainerFunction(e)){P=o.relevantContainerElement;return true;}});return P?P:false;};M.getMetadataForPropagation=function(p,e){var r=false;M._getPropagation(p,e,function(P){if(P.metadataFunction){r=P.metadataFunction(e,P.relevantContainerElement);return r?true:false;}});return r?r:false;};M.propagateMetadataToElementOverlay=function(t,p,e){var P=M.getRelevantContainerForPropagation(p,e);var v=M.getMetadataForPropagation(p,e);if(!P&&!v){return t;}var r=q.extend(true,{},t);if(P){r.relevantContainer=P;}if(v){if(v.actions===null){var a=e.getMetadata().getAllAggregations();var A=Object.keys(a);if(r.aggregations){A=A.concat(Object.keys(r.aggregations).filter(function(s){return A.indexOf(s)<0;}));}else{r.aggregations={};}A.forEach(function(s){if(r.aggregations[s]&&r.aggregations[s].actions){r.aggregations[s].actions=null;}});}return q.extend(true,r,v);}return r;};return M;},true);
