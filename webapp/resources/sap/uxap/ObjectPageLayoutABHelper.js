/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Metadata","sap/ui/core/CustomData","sap/ui/base/ManagedObjectObserver","./AnchorBar","sap/m/Button","sap/ui/core/IconPool"],function(q,M,C,a,A,B,I){"use strict";var b=M.createClass("sap.uxap._helpers.AB",{constructor:function(o){this._oObjectPageLayout=o;this._iScrollDuration=o._iScrollToSectionDuration;this._oObserver=new a(this._proxyStateChanges.bind(this));}});b.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout;};b.prototype._proxyStateChanges=function(o){var O=o.object,d=this._findExistingClone(O),p=o.name,v=o.current,s="set"+c(p);if(d){d[s].call(d,v);}};b.prototype._findExistingClone=function(o){var d,s=o.getId()+"-__clone",e=this._getAnchorBar(),f=e.getContent();f.some(function(g){if(g.getId().indexOf(s)===0){d=g;return true;}});return d;};b.prototype._getAnchorBar=function(){var o=this.getObjectPageLayout().getAggregation("_anchorBar");if(!o){o=new A({id:this.getObjectPageLayout().getId()+"-anchBar",showPopover:this.getObjectPageLayout().getShowAnchorBarPopover()});this.getObjectPageLayout().setAggregation("_anchorBar",o,true);}return o;};b.prototype._buildAnchorBar=function(){var s=this.getObjectPageLayout().getSections()||[],o=this._getAnchorBar();if(o&&this.getObjectPageLayout().getShowAnchorBar()){o._resetControl();this._oObserver.disconnect();s.forEach(function(S){if(!S.getVisible()||!S._getInternalVisible()){return;}var d,e=S.getSubSections()||[];d=this._buildAnchorBarButton(S,true);if(d){o.addContent(d);e.forEach(function(f){if(!f.getVisible()||!f._getInternalVisible()){return;}var g=this._buildAnchorBarButton(f,false);if(g){o.addContent(g);}},this);}},this);}};b.prototype._focusOnSectionWhenUsingKeyboard=function(e){var s=e.srcControl.data(),S=sap.ui.getCore().byId(s.sectionId),o=this.getObjectPageLayout();if(S&&!s.bHasSubMenu&&!o.getUseIconTabBar()){q.sap.delayedCall(this._iScrollDuration,S.$(),"focus");}};b.prototype._buildAnchorBarButton=function(s,i){var o=null,O=this.getObjectPageLayout(),d,e=this._getAnchorBar(),f,S=s.getAggregation("subSections"),g=this._focusOnSectionWhenUsingKeyboard.bind(this),E={onsapenter:g,onsapspace:g};if(s.getVisible()&&s._getInternalVisible()){d=s.getCustomAnchorBarButton();if(!d){f=e.getId()+"-"+s.getId()+"-anchor";o=new B({ariaDescribedBy:s,id:f});o.addEventDelegate(E);var t=(s._getInternalTitle()!="")?s._getInternalTitle():s.getTitle();o.setText(t);}else{o=d.clone();this._oObserver.observe(d,{properties:true});}O._oSectionInfo[s.getId()].buttonId=o.getId();o.addCustomData(new C({key:"sectionId",value:s.getId()}));o.addCustomData(new C({key:"bTitleVisible",value:s._getInternalTitleVisible()}));if(!i){o.addCustomData(new C({key:"secondLevel",value:true}));}if(S&&S.length>1){var v=S.filter(function(h){return h.getVisible();}).length;if(v>1){o.addCustomData(new C({key:"bHasSubMenu",value:true}));if(O.getShowAnchorBarPopover()){o.setIcon(I.getIconURI("slim-arrow-down"));o.setIconFirst(false);}}}}return o;};function c(n){return n.substring(0,1).toUpperCase()+n.substring(1);}return b;},false);
